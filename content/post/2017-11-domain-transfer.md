---
title: ブログ移行計画 -その2-
date: 2017-11-18
draft: true
tags:
- トリログ
- 会社
- Tech
- 備忘録
description: ドメイン移管作業
keywords:
- 株式会社ワタリドリ
- wataridori inc.
- blog
- wtrdr
isCJKLanguage: true
---
## ドメイン移管作業
### お名前.com => さくらインターネット

実は弊社ドメインがある。全然使ってないけど笑
`wataridori.co.jp`
という立派なやつが！！

昔はさくらインターネット使っていたんだが、
試しに他のやつにしようと思ってお名前.comでメールサーバーとドメインを管理してもらっている。

全然使っていなかったからいいんだが、ブログ移行作業中に気づいた。
このメールサーバーに付属のドメインサーバーがAレコード、CNAMEレコード、サブドメインが設定できないことに。。。

無念だ。

でも激安だったから月額にしておいてよかった。

これはさくらインターネットに戻すしかないな。
ということで移管作業開始。

### さくらのメールボックスの利用を開始する

結局やりたいことってDNSレコードをいじって、メールはさくら、ブログはgithub pageに飛ばしたい。
くらいなのです。

とりあえず2週間無料らしいので[さくらのメールボックス](https://www.sakura.ne.jp/mail/)を試して無理そうならレンタルサーバー借りることにしよう。

### ドメイン移管依頼

調べてみるところによると属性型JPドメイン（co.jpとか）は無料で移管可能。（そういうもんらしい）

さくらの方から申請ををするとお名前.comの方に移管依頼が飛ぶっぽい。[参考URL](https://help.sakura.ad.jp/hc/ja/articles/206052992?_ga=2.175047842.1428514606.1511015094-2024478295.1510720885&_bdld=LhK7y.l+Z+SbR)
お名前.comの方には特に作業が必要なさそう。[参考URL](https://help.onamae.com/app/answers/detail/a_id/8593)
（後日メールがきて承認すれば大丈夫だった）

ということでお問い合わせからメッセージを送る。
少ししてさくらインターネットから以下のようなメールが届いて

> ドメイン: wataridori.co.jp
> 
> 平素よりさくらインターネットを御利用頂きまして
> 誠に有難うございます。ドメイン担当の富家です。
> 
> 本日、上記属性型・地域型ドメインの指定事業者変更申請を
> 行いましたので、お知らせします。
> 
> ==============================================================
> 
> 　申請番号：XXXXXXXXXXXXXXX
> 　現在の指定事業者：YYYYYYYYYYYYYYYYYYY
> 
> ==============================================================

その後お名前.comから以下のようなメールが届いて

> ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
> ■ お名前.com  by GMO ■
> ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
> An English version of this message is contained below.
> ───────────────────────────────────
> ■重要■トランスファー申請に関する確認のご連絡
> ───────────────────────────────────
> XXXXXXXXXXXXXXX 様
> 
> ドメイン名：wataridori.co.jp
> 
> お名前.com  by GMOは、上記ドメインについて に他社
> レジストラへの、トランスファー申請を承りました。
> 
> トランスファー手続きにつきまして、期日までにお客様のご意思を確認の上、
> 承認・拒否どちらかのお手続きをお願いいたします。
> 
> 【対応期日】
> 　各種JPドメイン：本メール送信日時から168時間（7日）後まで
> 　JPドメイン以外：本メール送信日時から96時間（4日）後まで
> 
> 【お手続き方法】
> 1.下記URLへアクセスしてください。
> http://url!!!!!!!!!!!!!!!!!!!!!!!!!!!
> 2.ドメイン名をご確認の上、トランスファーを承認する場合は「承認する」、
> 　拒否する場合は「拒否する」をクリックしてください。
> 3.確認画面が表示されますので内容を確認し、間違いなければ「完了」をク
> ......

指定されたURLに飛んで承認して移管作業は終了。

## github pageをhttps対応しつつカスタムドメインにする
一足飛びになるが、github pageでカスタムドメインを設定するとsslは使えなくなる。
特にgithub pageの方には設定とかもなさそう無理なのだろう。

そこで[Cloudflare](https://www.cloudflare.com/)を使ってhttps化する。

### Cloudflareの設定

**Cloudflareとは**
CDNサービスの一種。
コンテンツキャッシュしたりして高速化したりアプリに到達する前に攻撃を抑えたりすることができるようにする。

CloudflareはメインとしてSaaSの手前に置いてセキュリティ担保したり高速化したりするものみたいだ。
なので client -> Cloudflare -> github pages という構成にする。

#### Cloudflareのサインアップ
[Cloudflareサインアップ](https://www.cloudflare.com/a/sign-up)
ここにメールアドレスとパスワード。

#### ドメインの設定
ログインした後に[Add Site](https://www.cloudflare.com/a/setup)からドメインを追加。
今回は`wataridori.co.jp`に対するDNSの設定を行うので`wataridori.co.jp`を追加した。

自動的にさくらインターネットのレコード設定が読み込まれているので、
そこに CNAME wtrdr.github.io を追加

Free Websiteを選んで、次に出てくるネームサーバの情報をさくらインターネットのネームサーバに追加。

#### セキュリティ設定

ダッシュボードの**Crypto**を選択し先に進むとSSLってのがある。
ここFullでもやり方があるらしいが一旦Flexibleにしておく。

Full:     client --SSL-> Cloudflare --SSL--> github page
Flexible: client --SSL-> Cloudflare -------> github page

ってのが違いっぽい。

------

Always Use HTTPSをonにする

------

HTTP Strict Transport Security (HSTS)の箇所をEnable HSTSをクリックして
[I understand] => [Next]と先に進んで以下のように設定して[Save]

------

さてこれでセキュリティ周りの設定は完了か。









